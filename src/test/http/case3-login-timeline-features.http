### Authentication Controller E2E Tests
### Base URL and Environment Variables
@baseUrl = http://localhost:8082

###############################################################################
### 1. 로그인
###############################################################################
@case1Path = /api/authentication

### 1. 로그인
POST http://localhost:8084{{case1Path}}/login
Content-Type: application/json

{
  "email": "case3_A@gmail.com",
  "password": "Password123!@#$"
}

> {%
    // 로그인 응답 확인
    client.log("Login Response Status: " + response.status);

    // 토큰 저장
    try {
        var token = null;

        // Authorization 헤더에서 토큰 확인 (메인 소스)
        var authHeader = response.headers.valueOf("Authorization");
        if (authHeader && authHeader.startsWith("Bearer ")) {
            token = authHeader.substring(7);
            client.log("✓ Found token in Authorization header");
        }

        // 토큰 저장
        if (token) {
            client.global.set("accessToken", token);
            client.log("✓ Access Token saved: " + token);

            // 디버깅: 저장된 토큰 확인
            var savedToken = client.global.get("accessToken");
            client.log("✓ Verified saved token: " + (savedToken ? "OK" : "Failed"));
        } else {
            client.log("✗ No access token found in Authorization header");

            // 모든 헤더 출력 (디버깅용)
            client.log("Available headers: " + response.headers.valuesOf().join(", "));
        }

        // 응답 상태 확인
        if (response.body) {
            client.log("Login status: ok=" + response.body.ok + ", reason=" + response.body.reason);
        }
    } catch (e) {
        client.log("Error: " + e.message);
    }

    client.test("Token received", function() {
        var savedToken = client.global.get("accessToken");
        client.assert(savedToken !== null && savedToken !== undefined, "Token received and saved");
    });
%}

###############################################################################
### 2. 팔로우하는 멤버들의 최근 글들
###############################################################################
@case2Path = /api/timeline/posts/followings

### 2. 팔로우하는 멤버들의 최근 글들
GET {{baseUrl}}{{case2Path}}
Authorization: Bearer {{accessToken}}



###############################################################################
### 3. 댓글 많은 글들
###############################################################################
@case3Path = /api/timeline/posts/most-commented

### 3. 댓글 많은 글들
GET {{baseUrl}}{{case3Path}}
Authorization: Bearer {{accessToken}}


###############################################################################
### 4. 인기 게시글
###############################################################################
@case4Path = /api/timeline/posts/most-popular

### 4. 인기 게시글
GET {{baseUrl}}{{case4Path}}
Authorization: Bearer {{accessToken}}


###############################################################################
### 5. 게시글 상세 조회
###############################################################################
@case5Path = /api/timeline/posts

### 5. 게시글 상세 조회
GET {{baseUrl}}{{case5Path}}
Authorization: Bearer {{accessToken}}



###############################################################################
### 6. 기간검색
###############################################################################
#@case5Path = /api/timeline/posts/
#
#### 4. 인기 게시글
#GET {{baseUrl}}{{case5Path}}
#Authorization: Bearer {{accessToken}}

